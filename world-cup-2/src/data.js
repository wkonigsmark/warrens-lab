export const RANKINGS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTVvIfHFjZgu-7IHXuaRB236HXxyKxftdabTXm-x6eItHaJZzxGyla-0uENR_J01DfPlkPIwXTIkYxL/pub?gid=639413055&single=true&output=csv';
export const SCHEDULE_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR1lwbUFU9jGYRL04_5morUHJEAbDOOoJDDGL1-rynlQs0ZwKzCPy6FBukkkSMak5gZ-6saW7hs3-fg/pub?gid=0&single=true&output=csv';

export const FALLBACK_RANKINGS = `Team,Group,W-Index,Status
Spain,H,100.0%,Qualified
France,I,99.0%,Qualified
Argentina,J,98.8%,Qualified
England,L,98.2%,Qualified
Brazil,C,95.2%,Qualified
Portugal,K,94.5%,Qualified
Germany,E,93.0%,Qualified
Netherlands,F,93.0%,Qualified
Belgium,G,87.8%,Qualified
Italy,B,86.9%,Not Qualified
Colombia,K,86.7%,Qualified
Norway,I,84.2%,Qualified
Uruguay,H,83.9%,Qualified
USA,D,81.5%,Qualified
Mexico,A,81.5%,Qualified
Morocco,C,78.6%,Qualified
Croatia,L,78.4%,Qualified
Ecuador,E,74.6%,Qualified
Switzerland,B,72.9%,Qualified
Japan,F,72.8%,Qualified
Denmark,A,70.8%,Not Qualified
Sweden,F,60.7%,Not Qualified
Senegal,I,54.9%,Qualified
Korea Republic,A,53.1%,Qualified
Austria,J,52.7%,Qualified
Türkiye,D,51.7%,Qualified
Ukraine,F,51.3%,Not Qualified
Canada,B,50.9%,Qualified
IR Iran,G,50.5%,Qualified
Algeria,J,50.1%,Qualified
Poland,F,50.0%,Not Qualified
Paraguay,D,50.0%,Qualified
Egypt,G,49.5%,Qualified
Scotland,C,49.2%,Qualified
Côte d'Ivoire,E,49.2%,Qualified
Australia,D,49.1%,Qualified
Wales,B,49.1%,Not Qualified
Tunisia,F,47.5%,Qualified
Czechia,A,46.3%,Not Qualified
Slovakia,D,46.3%,Qualified
Panama,L,46.2%,Qualified
Romania,D,45.6%,Qualified
Ghana,L,45.2%,Qualified
South Africa,A,44.4%,Qualified
Bolivia,I,43.6%,Not Qualified
Congo DR,K,43.1%,Not Qualified
North Macedonia,A,42.9%,Not Qualified
Qatar,B,40.7%,Qualified
Northern Ireland,B,40.6%,Not Qualified
Iraq,I,40.1%,Not Qualified
Republic of Ireland,A,40.1%,Not Qualified
Saudi Arabia,H,39.9%,Qualified
Albania,F,39.0%,Not Qualified
Kosovo,D,38.8%,Qualified
Jamaica,K,37.8%,Not Qualified
New Zealand,G,35.1%,Qualified
Uzbekistan,K,31.7%,Qualified
Cabo Verde,H,28.8%,Qualified
Curaçao,E,26.7%,Qualified
Jordan,J,24.8%,Qualified
Suriname,I,21.5%,Not Qualified
Bosnia and Herzegovina,B,10.2%,Not Qualified
Haiti,C,8.0%,Qualified
New Caledonia,K,0.0%,Not Qualified`;

export const FALLBACK_SCHEDULE = `Date,Hour,Time,Match,Venue,City,Team 1,Team 2,Team 1 Group Key,Team 2 Group Key,Team 1 Index,Team 2 Index,Absolute Difference,Sum Index,Balance Index,Power Index,Balance + Power,Matchup Index,Matchup Rank
11-Jun-26,15,3:00 PM,1,Estadio Azteca,Mexico City,Mexico,South Africa,A2,A3,79.8%,39.5%,40.3%,119.4%,58.1%,54.2%,112.3%,49.5%,44
11-Jun-26,22,10:00 PM,2,Estadio Akron,Guadalajara,Korea Republic,Denmark,A1,A4,49.0%,68.2%,19.2%,117.3%,80.6%,52.6%,133.2%,63.1%,15
12-Jun-26,15,3:00 PM,3,BMO Field,Toronto,Canada,Italy,B1,B4,46.6%,85.7%,39.1%,132.4%,59.4%,85.7%,145.1%,16.0%,15
12-Jun-26,21,9:00 PM,4,SoFi Stadium,Los Angeles,USA,Paraguay,D3,D2,79.9%,45.6%,34.3%,125.5%,64.5%,45.6%,110.1%,47.0%,47
13-Jun-26,21,9:00 PM,5,Gillette Stadium,Boston,Haiti,Scotland,C2,C4,0.0%,44.8%,44.8%,44.8%,53.3%,44.8%,98.1%,54.0%,54
13-Jun-26,24,12:00 AM,6,BC Place,Vancouver,Australia,Türkiye,D1,D4,44.6%,47.4%,2.8%,92.1%,98.1%,47.4%,145.5%,14.0%,14
13-Jun-26,18,6:00 PM,7,MetLife Stadium,"New York/New Jersey",Brazil,Morocco,,,,,,,,,,,
13-Jun-26,15,3:00 PM,8,Levi's Stadium,San Francisco Bay Area,Qatar,Switzerland,,,,,,,,,,,
14-Jun-26,19,7:00 PM,9,Lincoln Financial Field,Philadelphia,Côte d'Ivoire,Ecuador,,,,,,,,,,,
14-Jun-26,13,1:00 PM,10,NRG Stadium,Houston,Germany,Curaçao,,,,,,,,,,,
14-Jun-26,16,4:00 PM,11,AT&T Stadium,Dallas,Netherlands,Japan,,,,,,,,,,,
14-Jun-26,22,10:00 PM,12,Estadio BBVA,Monterrey,Sweden,Tunisia,,,,,,,,,,,
15-Jun-26,18,6:00 PM,13,Hard Rock Stadium,Miami,Saudi Arabia,Uruguay,,,,,,,,,,,
15-Jun-26,12,12:00 PM,14,Mercedes-Benz Stadium,Atlanta,Spain,Cabo Verde,,,,,,,,,,,
15-Jun-26,21,9:00 PM,15,SoFi Stadium,Los Angeles,IR Iran,New Zealand,,,,,,,,,,,
15-Jun-26,15,3:00 PM,16,Lumen Field,Seattle,Belgium,Egypt,,,,,,,,,,,
16-Jun-26,15,3:00 PM,17,MetLife Stadium,"New York/New Jersey",France,Senegal,,,,,,,,,,,
16-Jun-26,18,6:00 PM,18,Gillette Stadium,Boston,Bolivia,Norway,,,,,,,,,,,
16-Jun-26,21,9:00 PM,19,Arrowhead Stadium,Kansas City,Argentina,Algeria,,,,,,,,,,,
16-Jun-26,24,12:00 AM,20,Levi's Stadium,San Francisco Bay Area,Austria,Jordan,,,,,,,,,,,
17-Jun-26,19,7:00 PM,21,BMO Field,Toronto,Ghana,Panama,,,,,,,,,,,
17-Jun-26,16,4:00 PM,22,AT&T Stadium,Dallas,England,Croatia,,,,,,,,,,,
17-Jun-26,13,1:00 PM,23,NRG Stadium,Houston,Portugal,Congo DR,,,,,,,,,,,
17-Jun-26,22,10:00 PM,24,Estadio Azteca,Mexico City,Uzbekistan,Colombia,,,,,,,,,,,
18-Jun-26,12,12:00 PM,25,Mercedes-Benz Stadium,Atlanta,Denmark,South Africa,,,,,,,,,,,
18-Jun-26,15,3:00 PM,26,SoFi Stadium,Los Angeles,Switzerland,Italy,,,,,,,,,,,
18-Jun-26,18,6:00 PM,27,BC Place,Vancouver,Canada,Qatar,,,,,,,,,,,
18-Jun-26,21,9:00 PM,28,Estadio Akron,Guadalajara,Mexico,Korea Republic,,,,,,,,,,,
19-Jun-26,21,9:00 PM,29,Lincoln Financial Field,Philadelphia,Brazil,Haiti,,,,,,,,,,,
19-Jun-26,18,6:00 PM,30,Gillette Stadium,Boston,Scotland,Morocco,,,,,,,,,,,
19-Jun-26,24,12:00 AM,31,Levi's Stadium,San Francisco Bay Area,Türkiye,Paraguay,,,,,,,,,,,
19-Jun-26,15,3:00 PM,32,Lumen Field,Seattle,USA,Australia,,,,,,,,,,,
20-Jun-26,16,4:00 PM,33,BMO Field,Toronto,Germany,Côte d'Ivoire,,,,,,,,,,,
20-Jun-26,20,8:00 PM,34,Arrowhead Stadium,Kansas City,Ecuador,Curaçao,,,,,,,,,,,
20-Jun-26,13,1:00 PM,35,NRG Stadium,Houston,Netherlands,Sweden,,,,,,,,,,,
20-Jun-26,24,12:00 AM,36,Estadio BBVA,Monterrey,Tunisia,Japan,,,,,,,,,,,
21-Jun-26,18,6:00 PM,37,Hard Rock Stadium,Miami,Uruguay,Cabo Verde,,,,,,,,,,,
21-Jun-26,12,12:00 PM,38,Mercedes-Benz Stadium,Atlanta,Spain,Saudi Arabia,,,,,,,,,,,
21-Jun-26,15,3:00 PM,39,SoFi Stadium,Los Angeles,Belgium,IR Iran,,,,,,,,,,,
21-Jun-26,21,9:00 PM,40,BC Place,Vancouver,New Zealand,Egypt,,,,,,,,,,,
22-Jun-26,20,8:00 PM,41,MetLife Stadium,"New York/New Jersey",Norway,Senegal,,,,,,,,,,,
22-Jun-26,17,5:00 PM,42,Lincoln Financial Field,Philadelphia,France,Bolivia,,,,,,,,,,,
22-Jun-26,13,1:00 PM,43,AT&T Stadium,Dallas,Argentina,Austria,,,,,,,,,,,
22-Jun-26,23,11:00 PM,44,Levi's Stadium,San Francisco Bay Area,Jordan,Algeria,,,,,,,,,,,
23-Jun-26,16,4:00 PM,45,Gillette Stadium,Boston,England,Ghana,,,,,,,,,,,
23-Jun-26,19,7:00 PM,46,BMO Field,Toronto,Panama,Croatia,,,,,,,,,,,
23-Jun-26,13,1:00 PM,47,NRG Stadium,Houston,Portugal,Uzbekistan,,,,,,,,,,,
23-Jun-26,22,10:00 PM,48,Estadio Akron,Guadalajara,Colombia,Congo DR,,,,,,,,,,,
24-Jun-26,18,6:00 PM,49,Hard Rock Stadium,Miami,Scotland,Brazil,,,,,,,,,,,
24-Jun-26,18,6:00 PM,50,Mercedes-Benz Stadium,Atlanta,Morocco,Haiti,,,,,,,,,,,
24-Jun-26,15,3:00 PM,51,BC Place,Vancouver,Switzerland,Canada,,,,,,,,,,,
24-Jun-26,15,3:00 PM,52,Lumen Field,Seattle,Italy,Qatar,,,,,,,,,,,
24-Jun-26,21,9:00 PM,53,Estadio Azteca,Mexico City,Denmark,Mexico,,,,,,,,,,,
24-Jun-26,21,9:00 PM,54,Estadio BBVA,Monterrey,South Africa,Korea Republic,,,,,,,,,,,
25-Jun-26,16,4:00 PM,55,Lincoln Financial Field,Philadelphia,Curaçao,Côte d'Ivoire,,,,,,,,,,,
25-Jun-26,16,4:00 PM,56,MetLife Stadium,"New York/New Jersey",Ecuador,Germany,,,,,,,,,,,
25-Jun-26,19,7:00 PM,57,AT&T Stadium,Dallas,Japan,Sweden,,,,,,,,,,,
25-Jun-26,19,7:00 PM,58,Arrowhead Stadium,Kansas City,Tunisia,Netherlands,,,,,,,,,,,
25-Jun-26,22,10:00 PM,59,SoFi Stadium,Los Angeles,Türkiye,USA,,,,,,,,,,,
25-Jun-26,22,10:00 PM,60,Levi's Stadium,San Francisco Bay Area,Paraguay,Australia,,,,,,,,,,,
26-Jun-26,15,3:00 PM,61,Gillette Stadium,Boston,Norway,France,,,,,,,,,,,
26-Jun-26,15,3:00 PM,62,BMO Field,Toronto,Senegal,Bolivia,,,,,,,,,,,
26-Jun-26,23,11:00 PM,63,Lumen Field,Seattle,Egypt,IR Iran,,,,,,,,,,,
26-Jun-26,23,11:00 PM,64,BC Place,Vancouver,New Zealand,Belgium,,,,,,,,,,,
26-Jun-26,20,8:00 PM,65,NRG Stadium,Houston,Cabo Verde,Saudi Arabia,,,,,,,,,,,
26-Jun-26,20,8:00 PM,66,Estadio Akron,Guadalajara,Uruguay,Spain,,,,,,,,,,,
27-Jun-26,17,5:00 PM,67,MetLife Stadium,"New York/New Jersey",Panama,England,,,,,,,,,,,
27-Jun-26,17,5:00 PM,68,Lincoln Financial Field,Philadelphia,Croatia,Ghana,,,,,,,,,,,
27-Jun-26,22,10:00 PM,69,Arrowhead Stadium,Kansas City,Algeria,Austria,,,,,,,,,,,
27-Jun-26,22,10:00 PM,70,AT&T Stadium,Dallas,Jordan,Argentina,,,,,,,,,,,
27-Jun-26,19.5,7:30 PM,71,Hard Rock Stadium,Miami,Colombia,Portugal,,,,,,,,,,,
27-Jun-26,19.5,7:30 PM,72,Mercedes-Benz Stadium,Atlanta,Congo DR,Uzbekistan,,,,,,,,,,,`;

export function parseCSV(csv) {
    const lines = csv.trim().split('\n').filter(l => l.trim() !== '');
    if (lines.length === 0) return [];

    const firstLine = lines[0];
    const delimiter = firstLine.includes('\t') ? '\t' : ',';

    const result = [];
    for (let i = 0; i < lines.length; i++) {
        const row = [];
        let current = '';
        let inQuotes = false;
        for (let char of lines[i]) {
            if (char === '"') inQuotes = !inQuotes;
            else if (char === delimiter && !inQuotes) {
                row.push(current.trim());
                current = '';
            } else {
                current += char;
            }
        }
        row.push(current.trim());
        result.push(row);
    }
    return result;
}

export function getFlagCode(name) {
    const m = {
        'Spain': 'es', 'France': 'fr', 'Argentina': 'ar', 'England': 'gb-eng',
        'Brazil': 'br', 'Portugal': 'pt', 'Germany': 'de', 'Netherlands': 'nl',
        'Belgium': 'be', 'Italy': 'it', 'Colombia': 'co', 'Norway': 'no',
        'Uruguay': 'uy', 'USA': 'us', 'Mexico': 'mx', 'Morocco': 'ma',
        'Croatia': 'hr', 'Ecuador': 'ec', 'Switzerland': 'ch', 'Japan': 'jp',
        'Denmark': 'dk', 'Sweden': 'se', 'Senegal': 'sn', 'Korea Republic': 'kr',
        'Austria': 'at', 'Türkiye': 'tr', 'Ukraine': 'ua', 'Canada': 'ca',
        'IR Iran': 'ir', 'Algeria': 'dz', 'Poland': 'pl', 'Paraguay': 'py',
        'Egypt': 'eg', 'Scotland': 'gb-sct', "Côte d'Ivoire": 'ci', 'Australia': 'au',
        'Wales': 'gb-wls', 'Tunisia': 'tn', 'Czechia': 'cz', 'Slovakia': 'sk',
        'Panama': 'pa', 'Romania': 'ro', 'Ghana': 'gh', 'South Africa': 'za',
        'Bolivia': 'bo', 'Congo DR': 'cd', 'North Macedonia': 'mk', 'Qatar': 'qa',
        'Northern Ireland': 'gb-nir', 'Iraq': 'iq', 'Republic of Ireland': 'ie',
        'Saudi Arabia': 'sa', 'Albania': 'al', 'Kosovo': 'xk', 'Jamaica': 'jm',
        'New Zealand': 'nz', 'Uzbekistan': 'uz', 'Cabo Verde': 'cv',
        'Curaçao': 'cw', 'Jordan': 'jo', 'Suriname': 'sr',
        'Bosnia and Herzegovina': 'ba', 'Haiti': 'ht', 'New Caledonia': 'nc'
    };
    return m[name] || 'un';
}

export async function fetchCSV(url) {
    let finalUrl = url;
    if (window.location.protocol === 'file:') {
        finalUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
    }
    const response = await fetch(finalUrl);
    if (!response.ok) throw new Error('Fetch failed');
    return await response.text();
}
