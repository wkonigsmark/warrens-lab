<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baby Bloomer | Intelligence Terminal</title>
    <meta name="description"
        content="A premium financial dashboard for monitoring major market indices with deep statistical insights.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #05070a;
            --card-bg: rgba(255, 255, 255, 0.02);
            --card-border: rgba(255, 255, 255, 0.08);
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --text-primary: #f3f4f6;
            --text-secondary: #6b7280;
            --glass-blur: blur(20px);
            --header-h: 60px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1rem;
            background-image: radial-gradient(circle at 50% 0%, #111827 0%, #05070a 100%);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-h);
            border-bottom: 1px solid var(--card-border);
            padding-bottom: 0.5rem;
        }

        .brand h1 {
            font-weight: 700;
            font-size: 1.1rem;
            letter-spacing: -0.01em;
            background: linear-gradient(to right, #ffffff, #9ca3af);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .brand span {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
        }

        .global-controls {
            display: flex;
            gap: 0.5rem;
        }

        button {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s;
            backdrop-filter: var(--glass-blur);
        }

        button:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        button.active {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        /* Market Pulse Grid */
        .market-pulse {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .pulse-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pulse-card:hover,
        .pulse-card.active {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .pulse-card.active {
            border-color: var(--accent-green);
        }

        .pulse-info .label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.2rem;
        }

        .pulse-info .price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .pulse-change {
            text-align: right;
        }

        .pulse-change .pct {
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Main Analysis View */
        .dashboard-main {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 1rem;
        }

        .chart-section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 1.25rem;
            position: relative;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .target-info h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .target-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.25rem;
            font-weight: 700;
            display: flex;
            align-items: baseline;
            gap: 0.75rem;
        }

        .target-change {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .chart-container {
            height: 380px;
            width: 100%;
        }

        .stats-sidebar {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.2s;
        }

        .stat-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 0.4rem;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .positive {
            color: var(--accent-green);
        }

        .negative {
            color: var(--accent-red);
        }

        .status-footer {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            font-size: 0.65rem;
            color: var(--text-secondary);
            padding-top: 1rem;
            border-top: 1px solid var(--card-border);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-green);
            box-shadow: 0 0 8px var(--accent-green);
        }

        @media (max-width: 1024px) {
            .dashboard-main {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }

            .market-pulse {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            header {
                flex-direction: column;
                height: auto;
                gap: 0.75rem;
                align-items: flex-start;
                padding-bottom: 1rem;
            }

            .market-pulse {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="brand">
                <h1>BABY BLOOMER</h1>
                <span>Terminal v2.0 // Yahoo Pivot</span>
            </div>
            <div class="global-controls">
                <button id="toggle-source-btn" onclick="toggleSource()">Go Live (Real Data)</button>
                <button onclick="resetAll()">Reset System</button>
            </div>
        </header>

        <div class="market-pulse" id="pulse-grid">
            <!-- Cards populated by JS -->
        </div>

        <main class="dashboard-main">
            <section class="chart-section">
                <div class="chart-header">
                    <div class="target-info">
                        <h2 id="active-symbol-label">S&P 500 Index</h2>
                        <div class="target-price" id="active-price">
                            <span>0.00</span>
                            <span class="target-change positive" id="active-change">+0.00%</span>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
                <div class="status-footer">
                    <div class="status-indicator">
                        <div class="dot" id="status-dot"></div>
                        <span id="status-text">Simulated Feed</span>
                    </div>
                    <div id="last-update">Last Update: Just now</div>
                </div>
            </section>

            <aside class="stats-sidebar">
                <div class="stat-card">
                    <div class="stat-label">Sigma (Volatility)</div>
                    <div class="stat-value" id="sigma-val">0.00%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Multiple (P/Î¼)</div>
                    <div class="stat-value" id="multiple-val">1.0000x</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Rolling Mean</div>
                    <div class="stat-value" id="mean-val">0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Market Regime</div>
                    <div class="stat-value" id="market-regime" style="font-size: 0.9rem;">Neutral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Samples / Confidence</div>
                    <div class="stat-value" id="sample-count" style="font-size: 0.9rem;">0 / High</div>
                </div>
            </aside>
        </main>
    </div>

    <script>
        const INDEXES = [
            { symbol: '^GSPC', label: 'S&P 500', base: 5024.31 },
            { symbol: '^IXIC', label: 'Nasdaq 100', base: 15990.66 },
            { symbol: '^DJI', label: 'Dow Jones', base: 38677.32 },
            { symbol: '^RUT', label: 'Russell 2000', base: 2009.99 }
        ];

        let activeIndex = INDEXES[0];
        let state = {}; // Stores { symbol: { dataPoints, labels, currentPrice, basePrice } }
        let chart;
        let isRealData = false;
        let updateInterval;

        // Initialize state for all indexes
        INDEXES.forEach(idx => {
            state[idx.symbol] = {
                dataPoints: [],
                labels: [],
                currentPrice: idx.base,
                basePrice: idx.base
            };
        });

        function initUI() {
            const grid = document.getElementById('pulse-grid');
            grid.innerHTML = '';
            INDEXES.forEach(idx => {
                const card = document.createElement('div');
                card.className = `pulse-card ${idx.symbol === activeIndex.symbol ? 'active' : ''}`;
                card.id = `card-${idx.symbol.replace('^', '')}`;
                card.onclick = () => switchIndex(idx);
                card.innerHTML = `
                    <div class="pulse-info">
                        <div class="label">${idx.label}</div>
                        <div class="price" id="p-price-${idx.symbol.replace('^', '')}">0.00</div>
                    </div>
                    <div class="pulse-change">
                        <div class="pct" id="p-change-${idx.symbol.replace('^', '')}">+0.00%</div>
                    </div>
                `;
                grid.appendChild(card);
            });
            updateUI();
        }

        function switchIndex(idx) {
            activeIndex = idx;
            document.querySelectorAll('.pulse-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`card-${idx.symbol.replace('^', '')}`).classList.add('active');
            document.getElementById('active-symbol-label').textContent = idx.label;

            // Re-render chart with new index data
            const s = state[idx.symbol];
            chart.data.labels = s.labels;
            chart.data.datasets[0].data = s.dataPoints;
            chart.data.datasets[0].label = idx.label;

            updateStats();
            chart.update('none');
        }

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: activeIndex.label,
                        data: [],
                        borderColor: '#10b981',
                        borderWidth: 1.5,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: (context) => {
                            const ctx = context.chart.ctx;
                            const gradient = ctx.createLinearGradient(0, 0, 0, 380);
                            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.1)');
                            gradient.addColorStop(1, 'rgba(16, 185, 129, 0)');
                            return gradient;
                        },
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#0a0c10',
                            borderColor: 'rgba(255,255,255,0.08)',
                            borderWidth: 1,
                            titleFont: { family: 'JetBrains Mono', size: 10 },
                            bodyFont: { family: 'JetBrains Mono', size: 12 },
                            padding: 10
                        }
                    },
                    scales: {
                        y: {
                            position: 'right',
                            grid: { color: 'rgba(255, 255, 255, 0.03)' },
                            ticks: {
                                color: '#4b5563',
                                font: { size: 9, family: 'JetBrains Mono' },
                                callback: val => val.toLocaleString()
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                color: '#4b5563',
                                font: { size: 9, family: 'JetBrains Mono' },
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 8
                            }
                        }
                    }
                }
            });
        }

        async function fetchAllData() {
            document.getElementById('status-text').textContent = "Updating System...";

            const fetchSymbol = async (idx) => {
                const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(idx.symbol)}?interval=2m&range=1d&includePrePost=false`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`;

                try {
                    const response = await fetch(proxyUrl);
                    const proxyData = await response.json();
                    const data = JSON.parse(proxyData.contents);

                    if (!data.chart || !data.chart.result) throw new Error("Invalid response");

                    const res = data.chart.result[0];
                    const meta = res.meta;
                    const timestamps = res.timestamp || [];
                    const quotes = res.indicators.quote[0].close || [];

                    const pts = [];
                    const lbls = [];
                    quotes.forEach((q, i) => {
                        if (q !== null) {
                            pts.push(q);
                            lbls.push(new Date(timestamps[i] * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                        }
                    });

                    state[idx.symbol] = {
                        dataPoints: pts,
                        labels: lbls,
                        currentPrice: pts[pts.length - 1],
                        basePrice: meta.regularMarketPreviousClose || meta.chartPreviousClose || pts[0]
                    };
                } catch (e) {
                    console.error(`Fetch error for ${idx.symbol}:`, e);
                }
            };

            await Promise.all(INDEXES.map(fetchSymbol));

            document.getElementById('status-text').textContent = "Live Stream: Yahoo Finance";
            isRealData = true;
            document.getElementById('toggle-source-btn').textContent = "Return to Simulation";
            document.getElementById('toggle-source-btn').classList.add('active');

            updateUI();
            switchIndex(activeIndex); // Refresh active view
        }

        function updateSimulation() {
            INDEXES.forEach(idx => {
                const s = state[idx.symbol];
                const drift = (Math.random() - 0.495) * (idx.base * 0.0005);
                s.currentPrice += drift;

                const now = new Date();
                s.labels.push(now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                s.dataPoints.push(s.currentPrice);

                if (s.dataPoints.length > 200) {
                    s.labels.shift();
                    s.dataPoints.shift();
                }
            });

            updateUI();
            const s = state[activeIndex.symbol];
            chart.data.labels = s.labels;
            chart.data.datasets[0].data = s.dataPoints;
            chart.update('none');
            updateStats();
        }

        function updateUI() {
            INDEXES.forEach(idx => {
                const s = state[idx.symbol];
                const priceEl = document.getElementById(`p-price-${idx.symbol.replace('^', '')}`);
                const changeEl = document.getElementById(`p-change-${idx.symbol.replace('^', '')}`);

                priceEl.textContent = s.currentPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                const pct = ((s.currentPrice - s.basePrice) / s.basePrice * 100).toFixed(2);
                changeEl.textContent = `${pct >= 0 ? '+' : ''}${pct}%`;
                changeEl.className = `pct ${pct >= 0 ? 'positive' : 'negative'}`;
            });

            // Update main view
            const s = state[activeIndex.symbol];
            document.getElementById('active-price').children[0].textContent = s.currentPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            const diff = s.currentPrice - s.basePrice;
            const pct = (diff / s.basePrice * 100).toFixed(2);
            const mainChange = document.getElementById('active-change');
            mainChange.textContent = `${diff >= 0 ? '+' : ''}${diff.toFixed(2)} (${pct >= 0 ? '+' : ''}${pct}%)`;
            mainChange.className = `target-change ${pct >= 0 ? 'positive' : 'negative'}`;

            document.getElementById('last-update').textContent = `Last Packet: ${new Date().toLocaleTimeString()}`;
        }

        function updateStats() {
            const s = state[activeIndex.symbol];
            const data = s.dataPoints;
            if (!data.length) return;

            const n = data.length;
            const mean = data.reduce((a, b) => a + b, 0) / n;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / n;
            const sigma = Math.sqrt(variance);
            const multiple = s.currentPrice / mean;

            document.getElementById('mean-val').textContent = mean.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('sigma-val').textContent = (sigma / mean * 100).toFixed(4) + '%';
            document.getElementById('multiple-val').textContent = multiple.toFixed(5) + 'x';
            document.getElementById('sample-count').textContent = `${n} / ${n > 50 ? 'High' : 'Accumulating'}`;

            const regime = document.getElementById('market-regime');
            if (multiple > 1.001) { regime.textContent = 'Expansion / Bullish'; regime.className = 'stat-value positive'; }
            else if (multiple < 0.999) { regime.textContent = 'Contraction / Bearish'; regime.className = 'stat-value negative'; }
            else { regime.textContent = 'Stable Equilibrium'; regime.className = 'stat-value'; }
        }

        function toggleSource() {
            if (isRealData) {
                isRealData = false;
                document.getElementById('toggle-source-btn').textContent = "Go Live (Real Data)";
                document.getElementById('toggle-source-btn').classList.remove('active');
                document.getElementById('status-text').textContent = "Simulated Feed";
                document.getElementById('status-dot').style.background = '#10b981';
                startSimulationMode();
            } else {
                fetchAllData();
            }
        }

        function resetAll() {
            Object.keys(state).forEach(sym => {
                const idx = INDEXES.find(i => i.symbol === sym);
                state[sym] = {
                    dataPoints: [],
                    labels: [],
                    currentPrice: idx.base,
                    basePrice: idx.base
                };
            });
            isRealData = false;
            toggleSource();
            initChart();
            startSimulationMode();
        }

        function startSimulationMode() {
            if (updateInterval) clearInterval(updateInterval);
            // Pre-fill some data if empty
            INDEXES.forEach(idx => {
                if (state[idx.symbol].dataPoints.length === 0) {
                    for (let i = 0; i < 60; i++) {
                        const s = state[idx.symbol];
                        s.currentPrice += (Math.random() - 0.5) * (idx.base * 0.002);
                        s.dataPoints.push(s.currentPrice);
                        s.labels.push(new Date(Date.now() - (60 - i) * 60000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                    }
                }
            });
            updateInterval = setInterval(updateSimulation, 2000);
        }

        window.onload = () => {
            initUI();
            initChart();
            startSimulationMode();
        };
    </script>
</body>

</html>