<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baby Bloomer | Financial Dashboard</title>
    <meta name="description"
        content="A premium financial dashboard for monitoring major market indices with deep statistical insights.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #0a0c10;
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.1);
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --glass-blur: blur(12px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0a0c10 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        h1 {
            font-weight: 700;
            font-size: 1.5rem;
            letter-spacing: -0.025em;
            background: linear-gradient(to right, #ffffff, #9ca3af);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 9999px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--accent-green);
            box-shadow: 0 0 8px var(--accent-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.4;
            }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
        }

        .main-card {
            grid-column: span 8;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 1.5rem;
            padding: 2rem;
            backdrop-filter: var(--glass-blur);
        }

        .stats-sidebar {
            grid-column: span 4;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 1.25rem;
            padding: 1.5rem;
            backdrop-filter: var(--glass-blur);
            transition: transform 0.2s ease, border-color 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .index-header {
            margin-bottom: 2rem;
        }

        .index-price {
            font-size: 3rem;
            font-weight: 700;
            display: flex;
            align-items: baseline;
            gap: 1rem;
        }

        .index-change {
            font-size: 1rem;
            font-weight: 500;
        }

        .positive {
            color: var(--accent-green);
        }

        .negative {
            color: var(--accent-red);
        }

        canvas {
            width: 100% !important;
            height: 300px !important;
        }

        .controls {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        button {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 1024px) {

            .main-card,
            .stats-sidebar {
                grid-column: span 12;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Baby Bloomer // Dashboard</h1>
            <div class="status-badge">
                <div class="status-dot"></div>
                <span id="status-text">Simulated Live Feed</span>
            </div>
        </header>

        <div class="dashboard-grid">
            <main class="main-card">
                <div class="index-header">
                    <div class="stat-label">S&P 500 Index (SPX)</div>
                    <div class="index-price" id="current-price">
                        <span>5,000.00</span>
                        <span class="index-change positive" id="price-change">+0.00%</span>
                    </div>
                </div>
                <canvas id="mainChart"></canvas>
                <div class="controls">
                    <button onclick="toggleSource()">Switch to Real Data (API Key Required)</button>
                    <button onclick="resetData()">Reset Simulation</button>
                </div>
            </main>

            <aside class="stats-sidebar">
                <div class="stat-card">
                    <div class="stat-label">Sigma (Volatility)</div>
                    <div class="stat-value" id="sigma-val">1.24%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Multiple</div>
                    <div class="stat-value" id="multiple-val">12.5x</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Mean (Last 24h)</div>
                    <div class="stat-value" id="mean-val">4,985.20</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Market Status</div>
                    <div class="stat-value" id="market-regime" style="font-size: 1rem; color: var(--accent-green);">
                        Stable / Neutral</div>
                </div>
            </aside>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        let dataPoints = [];
        let labels = [];
        let chart;
        let basePrice = 5024.31;
        let currentPrice = basePrice;
        let simulationInterval;
        let isRealData = false;

        const API_KEY = typeof CONFIG !== 'undefined' ? CONFIG.ALPHA_VANTAGE_KEY : '';

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'S&P 500 (SPY)',
                        data: dataPoints,
                        borderColor: '#10b981',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: (context) => {
                            const ctx = context.chart.ctx;
                            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                            gradient.addColorStop(0, 'rgba(16, 185, 129, 0.2)');
                            gradient.addColorStop(1, 'rgba(16, 185, 129, 0)');
                            return gradient;
                        },
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1f2937',
                            titleColor: '#9ca3af',
                            bodyColor: '#f3f4f6',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#9ca3af', font: { size: 10 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#9ca3af', font: { size: 10 }, maxRotation: 0 }
                        }
                    }
                }
            });
        }

        async function fetchRealData() {
            document.getElementById('status-text').textContent = "Connecting to Yahoo Finance...";

            try {
                // Yahoo Finance 5-minute data for the last 5 days
                const symbol = 'SPY';
                const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=5m&range=5d`;

                // Using AllOrigins as a proxy to bypass CORS and bot detection
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(yahooUrl)}`;

                const response = await fetch(proxyUrl);
                const proxyData = await response.json();
                const data = JSON.parse(proxyData.contents);

                if (!data.chart || !data.chart.result) {
                    throw new Error("Invalid Yahoo response");
                }

                const result = data.chart.result[0];
                const timestamps = result.timestamp;
                const quotes = result.indicators.quote[0].close;

                // Clean up null values often found in Yahoo data
                dataPoints = [];
                labels = [];

                for (let i = 0; i < timestamps.length; i++) {
                    if (quotes[i] !== null) {
                        const date = new Date(timestamps[i] * 1000);
                        labels.push(date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                        dataPoints.push(quotes[i]);
                    }
                }

                // Slice to the last 100 points for a clean chart
                const sliceCount = 100;
                if (dataPoints.length > sliceCount) {
                    dataPoints = dataPoints.slice(-sliceCount);
                    labels = labels.slice(-sliceCount);
                }

                currentPrice = dataPoints[dataPoints.length - 1];
                basePrice = dataPoints[0];

                chart.data.labels = labels;
                chart.data.datasets[0].data = dataPoints;
                chart.data.datasets[0].label = 'S&P 500 (SPY) - 5m';
                updateStats();
                chart.update();

                document.getElementById('status-text').textContent = "Live Yahoo Finance Feed (SPY)";
                isRealData = true;

                if (simulationInterval) clearInterval(simulationInterval);

                // Refresh every 5 minutes
                simulationInterval = setInterval(fetchRealData, 300000);

            } catch (error) {
                console.error("Error fetching Yahoo data:", error);
                alert("Yahoo Finance is blocking this request (standard for local development). I highly recommend getting a free key from 'Twelve Data' for true 1-minute access, or deploying this to Netlify where Yahoo might be more lenient.");
                startSimulation();
            }
        }

        function updateStats() {
            const n = dataPoints.length;
            if (n === 0) return;

            const mean = dataPoints.reduce((a, b) => a + b, 0) / n;
            const squareDiffs = dataPoints.map(value => Math.pow(value - mean, 2));
            const avgSquareDiff = squareDiffs.reduce((a, b) => a + b, 0) / n;
            const stdDev = Math.sqrt(avgSquareDiff);

            document.getElementById('current-price').children[0].textContent = currentPrice.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

            const percentChange = ((currentPrice - basePrice) / basePrice * 100).toFixed(2);
            const changeEl = document.getElementById('price-change');
            changeEl.textContent = (percentChange >= 0 ? '+' : '') + percentChange + '%';
            changeEl.className = 'index-change ' + (percentChange >= 0 ? 'positive' : 'negative');

            document.getElementById('mean-val').textContent = mean.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            document.getElementById('sigma-val').textContent = (stdDev / mean * 100).toFixed(3) + '%';

            const multipleVal = currentPrice / mean;
            document.getElementById('multiple-val').textContent = multipleVal.toFixed(4) + 'x';

            const regimeEl = document.getElementById('market-regime');
            if (multipleVal > 1.005) {
                regimeEl.textContent = 'Overextended (Bullish)';
                regimeEl.style.color = 'var(--accent-green)';
            } else if (multipleVal < 0.995) {
                regimeEl.textContent = 'Reverted (Bearish)';
                regimeEl.style.color = 'var(--accent-red)';
            } else {
                regimeEl.textContent = 'Stable / Neutral';
                regimeEl.style.color = 'var(--text-secondary)';
            }
        }

        function updateSimulation() {
            const change = (Math.random() - 0.48) * 4.0;
            currentPrice += change;

            const now = new Date();
            labels.push(now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
            dataPoints.push(currentPrice);

            if (labels.length > 100) {
                labels.shift();
                dataPoints.shift();
            }

            updateStats();
            chart.update('none');
        }

        function startSimulation() {
            if (simulationInterval) clearInterval(simulationInterval);
            document.getElementById('status-text').textContent = "Simulated Live Feed";

            // Generate some dummy data if empty
            if (dataPoints.length === 0) {
                for (let i = 0; i < 50; i++) {
                    labels.push(new Date(Date.now() - (50 - i) * 60000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                    dataPoints.push(basePrice + (Math.random() - 0.5) * 20);
                }
            }

            simulationInterval = setInterval(updateSimulation, 2000);
        }

        function toggleSource() {
            if (isRealData) {
                isRealData = false;
                startSimulation();
            } else {
                fetchRealData();
            }
        }

        function resetData() {
            dataPoints = [];
            labels = [];
            currentPrice = basePrice;
            if (simulationInterval) clearInterval(simulationInterval);
            initChart();
            startSimulation();
        }

        window.onload = () => {
            initChart();
            startSimulation();
        };
    </script>
</body>

</html>